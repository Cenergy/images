<!DOCTYPE html><html lang="zh-CN" data-default-color-scheme="&#34;auto&#34;"><head><meta charset="UTF-8"><link rel="apple-touch-icon" sizes="76x76" href="/blog/img/favicon.png"><link rel="icon" type="image/png" href="/blog/img/favicon.png"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,shrink-to-fit=no"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="theme-color" content="#2f4154"><meta name="description" content="真正的伟大,即在于以脆弱的凡人之躯而具有神性的不可战胜。"><meta name="author" content="Hai"><meta name="keywords" content="爱即是诗,blog"><title>Mapbox的表达式 - AIGISSS</title><link rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/4.5.3/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.staticfile.org/github-markdown-css/4.0.0/github-markdown.min.css"><link rel="stylesheet" href="/blog/lib/hint/hint.min.css"><link rel="stylesheet" href="https://cdn.staticfile.org/highlight.js/10.1.2/styles/tomorrow-night.min.css"><link rel="stylesheet" href="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css"><link rel="stylesheet" href="/blog/css/main.css"><link rel="stylesheet" href="/blog/styles/style.css"><script id="fluid-configs">var Fluid=window.Fluid||{},CONFIG={hostname:"www.aigisss.com",root:"/blog/",version:"1.8.7",typing:{enable:!0,typeSpeed:70,cursorChar:"✦",loop:!1},anchorjs:{enable:!0,element:"h1,h2,h3,h4,h5,h6",placement:"right",visible:"hover",icon:""},progressbar:{enable:!0,height_px:3,color:"#29d",options:{showSpinner:!1,trickleSpeed:200}},copy_btn:!0,image_zoom:{enable:!0},toc:{enable:!0,headingSelector:"h1,h2,h3,h4,h5,h6",collapseDepth:0},lazyload:{enable:!0,onlypost:!1},web_analytics:{enable:!0,baidu:"e57601b965796b6bd88329a0ca1e8b5e",google:147234769,gtag:null,tencent:{sid:null,cid:null},woyaola:null,cnzz:null,leancloud:{app_id:"diTi74ah5rpPDNa6bjS0VjqN-gzGzoHsz",app_key:"nHbjOKICQKYQtsVVJjeHYl0O",server_url:"https://diti74ah.lc-cn-n1-shared.com"},tajs:null}}</script><script src="/blog/js/utils.js"></script><script src="/blog/js/color-schema.js"></script><meta name="generator" content="Hexo 5.3.0"></head><body><header style="height:70vh"><nav id="navbar" class="navbar fixed-top navbar-expand-lg navbar-dark scrolling-navbar"><div class="container"><a class="navbar-brand" href="/blog/">&nbsp;<strong>AIGISSS</strong>&nbsp;</a> <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><div class="animated-icon"><span></span><span></span><span></span></div></button><div class="collapse navbar-collapse" id="navbarSupportedContent"><ul class="navbar-nav ml-auto text-center"><li class="nav-item"><a class="nav-link" href="http://www.aigisss.com"><i class="iconfont icon-google-fill"></i> 首页</a></li><li class="nav-item"><a class="nav-link" href="/blog/"><i class="iconfont icon-home-fill"></i> 博客</a></li><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" href="#" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><i class="iconfont icon-books"></i> 文章</a><div class="dropdown-menu" aria-labelledby="navbarDropdown"><a class="dropdown-item" href="/blog/archives/"><i class="iconfont icon-archive-fill"></i> 归档 </a><a class="dropdown-item" href="/blog/categories/"><i class="iconfont icon-category-fill"></i> 分类 </a><a class="dropdown-item" href="/blog/tags/"><i class="iconfont icon-tags-fill"></i> 标签</a></div></li><li class="nav-item"><a class="nav-link" href="/blog/photos/"><i class="iconfont icon-image"></i> 相册</a></li><li class="nav-item"><a class="nav-link" href="/blog/talks/"><i class="iconfont icon-kakao-talk-fill"></i> 说说</a></li><li class="nav-item"><a class="nav-link" href="/blog/about/"><i class="iconfont icon-user-fill"></i> 关于</a></li><li class="nav-item"><a class="nav-link" href="/blog/links/"><i class="iconfont icon-link-fill"></i> 友链</a></li><li class="nav-item" id="search-btn"><a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;<i class="iconfont icon-search"></i>&nbsp;</a></li><li class="nav-item" id="color-toggle-btn"><a class="nav-link" href="javascript:" rel="external nofollow noreferrer">&nbsp;<i class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a></li></ul></div></div></nav><div class="banner" id="banner" parallax="true" style="background:url(https://rmt.dogedoge.com/fetch/fluid/storage/bg/dojm2h.png?w=1920&q=100&fmt=webp) no-repeat center center;background-size:cover"><div class="full-bg-img"><div class="mask flex-center" style="background-color:rgba(0,0,0,.3)"><div class="page-header text-center fade-in-up"><span class="h2" id="subtitle" title="Mapbox的表达式"></span><div class="mt-3"><span class="post-meta"><i class="iconfont icon-date-fill" aria-hidden="true"></i> <time datetime="2019-10-18 09:52" pubdate>2019年10月18日 上午</time></span></div><div class="mt-1"><span class="post-meta mr-2"><i class="iconfont icon-chart"></i> 3k 字 </span><span class="post-meta mr-2"><i class="iconfont icon-clock-fill"></i> 38 分钟 </span><span id="leancloud-page-views-container" class="post-meta" style="display:none"><i class="iconfont icon-eye" aria-hidden="true"></i> <span id="leancloud-page-views"></span> 次</span></div></div></div></div></div></header><main><div class="container-fluid nopadding-x"><div class="row nomargin-x"><div class="d-none d-lg-block col-lg-2"></div><div class="col-lg-8 nopadding-x-md"><div class="container nopadding-x-md" id="board-ctn"><div class="py-5" id="board"><article class="post-content mx-auto"><h1 style="display:none">Mapbox的表达式</h1><p class="note note-info">本文最后更新于：14 天前</p><div class="markdown-body"><h2 id="Expressions"><a href="#Expressions" class="headerlink" title="Expressions"></a>Expressions</h2><p>mapbox-gl 的表达式可以将任何布局<code>layout</code>属性，绘图<code>paint</code>属性或过滤器<code>filter</code>的值指定为表达式。</p><img src="/blog/posts/9c1bf78f/expression.jpg" srcset="/blog/img/loading.gif" title="expression"> <a id="more"></a><h3 id="图层样式结构"><a href="#图层样式结构" class="headerlink" title="图层样式结构"></a>图层样式结构</h3><p>图层样式设置的结构为 JSON 结构，根级别结构如下：</p><figure class="highlight"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs json">&#123;<br>    <span class="hljs-attr">&quot;id&quot;</span>: <span class="hljs-string">&quot;road-layer-1&quot;</span>,<br>    <span class="hljs-attr">&quot;type&quot;</span>: <span class="hljs-string">&quot;line&quot;</span>,<br>    <span class="hljs-attr">&quot;source&quot;</span>: <span class="hljs-string">&quot;RoadSource&quot;</span>,<br>    <span class="hljs-attr">&quot;source-layer&quot;</span>: <span class="hljs-string">&quot;Road&quot;</span>,<br>    &quot;layout&quot;: &#123;...&#125;,<br>    &quot;paint&quot;: &#123;...&#125;,<br>    &quot;minzoom&quot;: 6,<br>    &quot;maxzoom&quot;: 17.5,<br>    &quot;filter&quot;: [...]<br>&#125;<br></code></pre></div></td></tr></table></figure><p>字段定义说明如下：</p><p><strong>id</strong>：图层 ID，必填项；说明：（值唯一，不能重复）</p><p><strong>type</strong>：图层渲染类型，必填项；（值域范围，参考本章「概述」）</p><p><strong>source</strong>：所使用的数据源 ID，说明：（当图层类型不为 background 时，该值为必填项）</p><p><strong>source-layer</strong>：所使用的 vector 数据源中的图层标识，说明：（当数据源类型为 vector 时，该值为必填项；其它数据源类型，去除该参数）</p><p><strong>layout</strong>：布局属性</p><p><strong>paint</strong>：绘制属性</p><p><strong>minzoom</strong>：图层可展示的最小缩放等级值，选填项；说明：（值为小数或整数，值域范围[0,24]，不设置该参数则地图允许的最小缩放等级内都可显示）</p><p><strong>maxzoom</strong>：图层可展示的最大缩放等级值，选填项；说明：（值为小数或整数，值域范围[0,24]，不设置该参数则地图允许的最大缩放等级内都可显示）</p><p><strong>filter</strong>：所使用数据源的 features 数据的过滤条件，选填项；说明：（当数据源 features 数据信息和 filter 条件匹配时图层才显示）</p><p>表达式定义了一个公式，用于使用以下描述的<em>运算符</em>计算属性的值。Mapbox GL 提供的表达式运算符集包括：</p><ul><li>Mathematical operators：数学计算器用于数值计算和其他数值相关的属性(如’+’ ‘-‘ ‘*‘ ‘/‘)</li><li>Logical operators：用于操纵布尔值和进行条件决策的逻辑运算符(如’case’ ‘let’)</li><li>String operators：用于操纵字符串的字符串运算符(如 string 转 number)</li><li>Data operators：提供调用数据源要素集属性的接口(如 ‘get’)</li><li>Camera operators：提供定义当前地图视角参数的接口(如 ‘zoom’)</li></ul><p>Expressions 表达式使用类似 Lisp 的语法，表达式数组的第一个元素是一个表示计算器的字符串，例如<code>*</code>或<code>case</code>。后面的元素是表达式的参数，每个参数要么是个原始的值（字符串、数字、布尔值或 null），要么是另一个表达式数组。</p><figure class="highlight json"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs json">[expression_name, argument_0, argument_1, ...]<br></code></pre></div></td></tr></table></figure><h3 id="Data-expressions"><a href="#Data-expressions" class="headerlink" title="Data expressions"></a>Data expressions</h3><p>数据表达式是任何能够调用要素数据的表达式，这种表达式使用如下一种数据计算器：<a target="_blank" rel="noopener external nofollow noreferrer" href="https://www.mapbox.com/mapbox-gl-js/style-spec#expressions-get"><code>get</code></a>、<a target="_blank" rel="noopener external nofollow noreferrer" href="https://www.mapbox.com/mapbox-gl-js/style-spec#expressions-has"><code>has</code></a>、<a target="_blank" rel="noopener external nofollow noreferrer" href="https://www.mapbox.com/mapbox-gl-js/style-spec#expressions-id"><code>id</code></a>、<a target="_blank" rel="noopener external nofollow noreferrer" href="https://www.mapbox.com/mapbox-gl-js/style-spec#expressions-geometry-type"><code>geometry-type</code></a>、<a target="_blank" rel="noopener external nofollow noreferrer" href="https://www.mapbox.com/mapbox-gl-js/style-spec#expressions-properties"><code>properties</code></a>、or <code>feature-state</code>。数据表达式利用要素集的属性或者状态来决定如何表达要素，它们可以在同一图层中创建不同的数据表达。</p><figure class="highlight json"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs json">&#123;<br>  <span class="hljs-attr">&quot;circle-color&quot;</span>: [<br>    <span class="hljs-string">&quot;rgb&quot;</span>,<br>    <span class="hljs-comment">// red is higher when feature.properties.temperature is higher</span><br>    [<span class="hljs-string">&quot;get&quot;</span>, <span class="hljs-string">&quot;temperature&quot;</span>],<br>    <span class="hljs-comment">// green is always zero</span><br>    <span class="hljs-number">0</span>,<br>    <span class="hljs-comment">// blue is higher when feature.properties.temperature is lower</span><br>    [<span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-number">100</span>, [<span class="hljs-string">&quot;get&quot;</span>, <span class="hljs-string">&quot;temperature&quot;</span>]]<br>  ]<br>&#125;<br></code></pre></div></td></tr></table></figure><p>上面这个例子使用<code>get</code>运算符来获取每个要素的温度值，这个结果值被用作 rgb 运算符的属性值，rgb 运算符是用红绿蓝定义颜色的操作符。</p><p>数据表达式可以被用作 filter 的属性值和大多数布局<code>layout</code>属性、绘画<code>paint</code>属性值的计算。然而，一些绘画<code>paint</code>和布局<code>layout</code>属性并不支持数据表达式。支持级别可以在支持列表中查看。<code>feature-state</code>运算符的数据表达式仅适用于绘画<code>paint</code>属性中。</p><h3 id="Camera-expressions"><a href="#Camera-expressions" class="headerlink" title="Camera expressions"></a>Camera expressions</h3><p>一个相机表达式是指任何使用 zoom 操作符的表达式，这些表达式允许一个图层改变地图的缩放等级。相机表达式可以用来创建表现的深度和控制数据密度。</p><figure class="highlight json"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs json">&#123;<br>  <span class="hljs-attr">&quot;circle-radius&quot;</span>: [<br>    <span class="hljs-string">&quot;interpolate&quot;</span>,<br>    [<span class="hljs-string">&quot;linear&quot;</span>],<br>    [<span class="hljs-string">&quot;zoom&quot;</span>],<br>    <span class="hljs-comment">// zoom is 5 (or less) -&gt; circle radius will be 1px</span><br>    <span class="hljs-number">5</span>,<br>    <span class="hljs-number">1</span>,<br>    <span class="hljs-comment">// zoom is 10 (or greater) -&gt; circle radius will be 5px</span><br>    <span class="hljs-number">10</span>,<br>    <span class="hljs-number">5</span><br>  ]<br>&#125;<br></code></pre></div></td></tr></table></figure><p>这个例子使用<code>interpolate</code>插值运算符用来定义缩放等级和圆大小的线性相对关系，在这个例子中，表达式表明了圆半径在 zoom 等级为 5 或者更低时为 1 像素，在 zoom 等级为 10 或者更高时为 5 像素。在此之间的 zoom，半径线性的在 1 到 5 像素之间变化。</p><p>相机表达式在任何表达式使用的地方都能使用，然后当相机表达式用于布局<code>layout</code>属性或者绘画<code>paint</code>属性的值时，它必须是以下面形式中的一种：</p><figure class="highlight json"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs json">[ <span class="hljs-string">&quot;interpolate&quot;</span>, interpolation, [<span class="hljs-string">&quot;zoom&quot;</span>], ... ]<br></code></pre></div></td></tr></table></figure><p>或者：</p><figure class="highlight json"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs json">[ <span class="hljs-string">&quot;step&quot;</span>, [<span class="hljs-string">&quot;zoom&quot;</span>], ... ]<br></code></pre></div></td></tr></table></figure><p>或者：</p><figure class="highlight json"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs json">[<br>    <span class="hljs-string">&quot;let&quot;</span>,<br>    ... variable bindings...,<br>    [ <span class="hljs-string">&quot;interpolate&quot;</span>, interpolation, [<span class="hljs-string">&quot;zoom&quot;</span>], ... ]<br>]<br></code></pre></div></td></tr></table></figure><p>或者：</p><figure class="highlight json"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs json">[<br>    <span class="hljs-string">&quot;let&quot;</span>,<br>    ... variable bindings...,<br>    [ <span class="hljs-string">&quot;step&quot;</span>, [<span class="hljs-string">&quot;zoom&quot;</span>], ... ]<br>]<br></code></pre></div></td></tr></table></figure><p>也就是说，用于布局<code>layout</code>属性和绘画<code>paint</code>属性时，<code>zoom</code>操作符只能被用作为<code>interpolate</code>、<code>step</code>或者<code>let</code>这三种操作符的内在操作符。在布局<code>layout</code>属性和绘画<code>paint</code>属性中使用相机表达式有个重要的区别，绘画<code>paint</code>属性相机表达式当 zoom 等级发生即使很小变化时就能够重绘，例如一个绘画<code>paint</code>属性相机表达式会持续的变化，当 zoom 等级在 4.1 和 4.6 之间变动时。与此同时，布局<code>layout</code>属性相机表达式只会在 zoom 整数跳变时计算值，例如在 4.1 到 4.6 之间变化时不会重新计算值，除非是重 5 到 4.</p><h3 id="Composition"><a href="#Composition" class="headerlink" title="Composition"></a>Composition</h3><p>一个单独的表达式可能使用 data 操作符、相机操作符和其他操作符的混合。这种组合表达式使一个图层的渲染决定于缩放等级和单独要素属性的组合。</p><figure class="highlight json"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs json">&#123;<br>  <span class="hljs-attr">&quot;circle-radius&quot;</span>: [<br>    <span class="hljs-string">&quot;interpolate&quot;</span>,<br>    [<span class="hljs-string">&quot;linear&quot;</span>],<br>    [<span class="hljs-string">&quot;zoom&quot;</span>],<br>    <span class="hljs-comment">// when zoom is 0, set each feature&#x27;s circle radius to the value of its &quot;rating&quot; property</span><br>    <span class="hljs-number">0</span>,<br>    [<span class="hljs-string">&quot;get&quot;</span>, <span class="hljs-string">&quot;rating&quot;</span>],<br>    <span class="hljs-comment">// when zoom is 10, set each feature&#x27;s circle radius to four times the value of its &quot;rating&quot; property</span><br>    <span class="hljs-number">10</span>,<br>    [<span class="hljs-string">&quot;*&quot;</span>, <span class="hljs-number">4</span>, [<span class="hljs-string">&quot;get&quot;</span>, <span class="hljs-string">&quot;rating&quot;</span>]]<br>  ]<br>&#125;<br></code></pre></div></td></tr></table></figure><p>一个同时使用了 data 和 camera 运算符的表达式同时考虑了 data 和 camera 表达式。</p><p><a target="_blank" rel="noopener external nofollow noreferrer" href="http://dev.minedata.cn/api/dev/js/guide/layer/style">http://dev.minedata.cn/api/dev/js/guide/layer/style</a></p><p>filter 规格</p><p>fliter 表示从所有图层过滤出特定特征的图层，有以下几种过滤形式：</p><p>1、存在过滤：</p><p>表达式形式：[way, key]</p><figure class="highlight csharp"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs csharp">存在过滤主要有“has”、“!has”两种形式<br><br>[<span class="hljs-meta"><span class="hljs-meta-string">&quot;has&quot;</span>, <span class="hljs-meta-string">&quot;count&quot;</span></span>]，表示过滤出存在属性<span class="hljs-string">&quot;count&quot;</span>的所有的feature数据<br>[<span class="hljs-meta"><span class="hljs-meta-string">&quot;!has&quot;</span>,<span class="hljs-meta-string">&quot;count&quot;</span></span>]，表示过滤出不存在属性<span class="hljs-string">&quot;count&quot;</span>的所有的feature数据<br></code></pre></div></td></tr></table></figure><p>2、比较过滤：</p><p>表达式形式：[way, key, value]</p><figure class="highlight awk"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs awk">比较过滤有等于“==”、大于“&gt;”、小于“&lt;”、不等于“!=”、大于等于“&gt;=”、小于等于“&lt;=”几种形式<br><br>[<span class="hljs-string">&quot;==&quot;</span>, <span class="hljs-string">&quot;count&quot;</span>, <span class="hljs-string">&quot;1000&quot;</span>]，表示过滤出属性<span class="hljs-string">&quot;count&quot;</span>值为<span class="hljs-number">1000</span>的feature数据，<br><span class="hljs-regexp">//</span>  注意此时数据源name存储的值为<span class="hljs-string">&quot;1000&quot;</span>而不是<span class="hljs-number">1000</span> 过滤时数据类型是严格匹配的<br></code></pre></div></td></tr></table></figure><p>3、成员过滤：</p><p>计算形式：[way, key, v0,v1，…，vn]</p><figure class="highlight awk"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs awk">成员过滤主要有<span class="hljs-string">&quot;in&quot;</span>、<span class="hljs-string">&quot;!in&quot;</span>两种形式<br><br>[<span class="hljs-string">&quot;in&quot;</span>, <span class="hljs-string">&quot;name&quot;</span>, <span class="hljs-string">&quot;point&quot;</span>, <span class="hljs-string">&quot;fill&quot;</span>, <span class="hljs-string">&quot;line&quot;</span>]，<br><span class="hljs-regexp">//</span>  表示过滤出属性<span class="hljs-string">&quot;name&quot;</span>值为<span class="hljs-string">&quot;point&quot;</span>, <span class="hljs-string">&quot;fill&quot;</span>, <span class="hljs-string">&quot;line&quot;</span>其中任一一个的feature数据<br></code></pre></div></td></tr></table></figure><p>4、组过滤：</p><p>计算形式：[way, key, v0,v1，…，vn]</p><figure class="highlight awk"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs awk">组过滤主要有组包含<span class="hljs-string">&quot;arrin&quot;</span>、组不包含<span class="hljs-string">&quot;!arrin&quot;</span>两种形式<br><br>[<span class="hljs-string">&quot;arrin&quot;</span>, <span class="hljs-string">&quot;name&quot;</span>, <span class="hljs-string">&quot;point&quot;</span>, <span class="hljs-string">&quot;fill&quot;</span>]，<br><span class="hljs-regexp">//</span>  表示过滤出属性<span class="hljs-string">&quot;name&quot;</span>值为[<span class="hljs-string">&quot;point&quot;</span>, <span class="hljs-string">&quot;fill&quot;</span>]、[<span class="hljs-string">&quot;point&quot;</span>]、[<span class="hljs-string">&quot;fill&quot;</span>]其中任一一个的feature数据<br><span class="hljs-regexp">//</span>  属性<span class="hljs-string">&quot;name&quot;</span>值为数组形式<br></code></pre></div></td></tr></table></figure><p>5、模糊过滤：</p><p>计算形式：[way, key, value]</p><figure class="highlight pgsql"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs pgsql">模糊过滤有“<span class="hljs-keyword">like</span>”、开始于“<span class="hljs-keyword">start</span>”、结束于“<span class="hljs-keyword">end</span>”几种形式<br><br>[&quot;like&quot;, &quot;code&quot;, &quot;101&quot;]，表示过滤出属性&quot;code&quot;值包含<span class="hljs-number">101</span>的feature数据<br>//  属性&quot;code&quot;值为字符形式<br></code></pre></div></td></tr></table></figure><p>6、组合过滤：</p><p>计算形式：[way, f0,f1，…，fn]</p><figure class="highlight prolog"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs prolog">组合过滤主要有等于<span class="hljs-string">&quot;all&quot;</span>、<span class="hljs-string">&quot;any&quot;</span>、<span class="hljs-string">&quot;none&quot;</span>三种形式<br><span class="hljs-string">&quot;all&quot;</span>表示满足所有过滤条件的数据，<span class="hljs-string">&quot;any&quot;</span>表示满足任一一个过滤条件的数据，<span class="hljs-string">&quot;none&quot;</span>表示过滤出不满足所有过滤条件的数据<br><br>[<span class="hljs-string">&quot;all&quot;</span>, [<span class="hljs-string">&quot;&lt;=&quot;</span>, <span class="hljs-string">&quot;count&quot;</span>, <span class="hljs-number">34</span>], [<span class="hljs-string">&quot;like&quot;</span>, <span class="hljs-string">&quot;code&quot;</span>, <span class="hljs-string">&quot;101&quot;</span>]]，<br>//  表示过滤出属性<span class="hljs-string">&quot;count&quot;</span>满足大于等于<span class="hljs-number">34</span>，属性<span class="hljs-string">&quot;code&quot;</span>值包含<span class="hljs-number">101</span>的feature数据<br></code></pre></div></td></tr></table></figure><p>函数对象语句</p><p>图层样式的某些 layout 或 paint 属性值支持函数对象语句的方式，属性值的最终结果由当前缩放等级或 feature 属性值进行相关计算而取得。</p><p>函数对象语句的结构为 JSON 结构，根级别结构如下：</p><figure class="highlight json"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs json">&#123;<br>    <span class="hljs-attr">&quot;property&quot;</span>: <span class="hljs-string">&quot;kind&quot;</span>,<br>    <span class="hljs-attr">&quot;base&quot;</span>: <span class="hljs-number">1</span>,<br>    <span class="hljs-attr">&quot;type&quot;</span>: <span class="hljs-string">&quot;interval&quot;</span>,<br>    <span class="hljs-attr">&quot;default&quot;</span>: <span class="hljs-string">&quot;#000000&quot;</span>,<br>    <span class="hljs-attr">&quot;stops&quot;</span>: [...]<br>&#125;<br></code></pre></div></td></tr></table></figure><p>字段定义说明如下：</p><p><strong>property</strong>：具体的 feature 属性标识；（非必输项）</p><p><strong>base</strong>：差值运算的曲率指数基数，控制最终计算结果值的增长率，值越大，最终计算结果值越大，值为 1 时，函数采用线性计算方式；（数值类型，默认值为 1）</p><p><strong>stops</strong>：差值运算项，定义输入值和输出值的集合，每一个 stop 由一个输入值和一个输出值组成；（数组形式，当 type 不为’identity’时，stops 为必输项）</p><p><strong>type</strong>：函数对象计算类型；（值域为[“identity”, “exponential”,”interval”, “categorical”]，默认值为’interval’）</p><p><strong>1、identity</strong>：恒等类型，最终输出值完全等于输入值；</p><figure class="highlight json"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs json"><span class="hljs-comment">/*示例：建筑物高度取用建筑物feature中的的属性字段levels的值*/</span><br>&#123;<br>    <span class="hljs-attr">&quot;extrusion-height&quot;</span>: &#123;<br>        <span class="hljs-attr">&quot;type&quot;</span>: <span class="hljs-string">&quot;identity&quot;</span>,<br>        <span class="hljs-attr">&quot;property&quot;</span>: <span class="hljs-string">&quot;levels&quot;</span><br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure><p><strong>2、exponential</strong>：指数类型，最终输出值由 stops 中的差值项进行区间范围内的指数级差值计算生成，stops 中的输入参数必须为数值类型；</p><figure class="highlight json"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs json"><span class="hljs-comment">/*示例：线的颜色值由feature中的price值进行区间指数级差值运算取得*/</span><br>&#123;<br>    <span class="hljs-attr">&quot;line-width&quot;</span>: &#123;<br>        <span class="hljs-attr">&quot;property&quot;</span>: <span class="hljs-string">&quot;price&quot;</span>,<br>        <span class="hljs-attr">&quot;type&quot;</span>: <span class="hljs-string">&quot;exponential&quot;</span>,<br>        <span class="hljs-attr">&quot;stops&quot;</span>: [[<span class="hljs-number">0</span>, <span class="hljs-number">1</span>],[<span class="hljs-number">10</span>, <span class="hljs-number">2</span>],[<span class="hljs-number">200</span>, <span class="hljs-number">3</span>],[<span class="hljs-number">300</span>, <span class="hljs-number">4</span>]],<br>        <span class="hljs-attr">&quot;default&quot;</span>: <span class="hljs-number">1</span><br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure><p><strong>3、interval</strong>：区间类型，最终输出值由 stops 中的差值项进行区间范围内的阶梯型差值计算生成，stops 中的输入参数必须为数值类型；</p><figure class="highlight json"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs json"><span class="hljs-comment">/*示例：线的颜色值由feature中的status值进行区间差值运算取得*/</span><br>&#123;<br>    <span class="hljs-attr">&quot;line-color&quot;</span>: &#123;<br>        <span class="hljs-attr">&quot;property&quot;</span>: <span class="hljs-string">&quot;status&quot;</span>,<br>        <span class="hljs-attr">&quot;type&quot;</span>: <span class="hljs-string">&quot;interval&quot;</span>,<br>        <span class="hljs-attr">&quot;stops&quot;</span>: [[<span class="hljs-number">0</span>, <span class="hljs-string">&quot;#999999&quot;</span>],[<span class="hljs-number">1</span>, <span class="hljs-string">&quot;#66cc00&quot;</span>],[<span class="hljs-number">2</span>, <span class="hljs-string">&quot;#ff9900&quot;</span>],[<span class="hljs-number">3</span>, <span class="hljs-string">&quot;#cc0000&quot;</span>],[<span class="hljs-number">4</span>, <span class="hljs-string">&quot;#9d0404&quot;</span>]],<br>        <span class="hljs-attr">&quot;default&quot;</span>: <span class="hljs-string">&quot;#66cc00&quot;</span><br>    &#125;<br>&#125;<br><br><span class="hljs-comment">/*示例：表示线宽根据zoom的值进行差值运算，当不添加type属性时，默认为interval类型*/</span><br>&#123;<br>    <span class="hljs-attr">&quot;line-width&quot;</span>: &#123;<br>        <span class="hljs-attr">&quot;base&quot;</span>: <span class="hljs-number">1.2</span>,<br>        <span class="hljs-attr">&quot;stops&quot;</span>: [[<span class="hljs-number">5</span>, <span class="hljs-number">0.8</span>], [<span class="hljs-number">20</span>, <span class="hljs-number">6</span>]]<br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure><p><strong>4、categorical</strong>：种别类型，最终输出值完全匹配 stops 中的输入值对应的输出值；</p><figure class="highlight json"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs json"><span class="hljs-comment">/*示例：面颜色由feature中的的属性字段space_type的值匹配stop中的输入值取得输出值*/</span><br>&#123;<br>    <span class="hljs-attr">&quot;line-color&quot;</span>: &#123;<br>        <span class="hljs-attr">&quot;property&quot;</span>: <span class="hljs-string">&quot;space_type&quot;</span>,<br>        <span class="hljs-attr">&quot;type&quot;</span>: <span class="hljs-string">&quot;categorical&quot;</span>,<br>        <span class="hljs-attr">&quot;stops&quot;</span>: [[<span class="hljs-number">1</span>, <span class="hljs-string">&quot;#f8e4d4&quot;</span>], [<span class="hljs-number">3</span>, <span class="hljs-string">&quot;#f5e8ca&quot;</span>], [<span class="hljs-number">5</span>, <span class="hljs-string">&quot;#f1d4ef&quot;</span>], [<span class="hljs-number">7</span>, <span class="hljs-string">&quot;#f7e8c3&quot;</span>], [<span class="hljs-number">9</span>, <span class="hljs-string">&quot;#f0d3ef&quot;</span>]]<br>        <span class="hljs-string">&quot;default&quot;</span>: <span class="hljs-string">&quot;#f1ebe7&quot;</span><br>    &#125;<br>&#125;<br></code></pre></div></td></tr></table></figure><p><strong>default</strong>：默认值，当差值运算没有结果时取用默认值；会在以下境况中遇到：</p><p>1、函数对象为<strong>categorical</strong>类型：当 feature 属性值不匹配 stops 中的输入值时；</p><p>2、函数对象为<strong>identity</strong>类型：当 feature 属性值不存在或属性值无效时；</p><p>3、函数对象为<strong>interval 或 exponential</strong>类型：当 feature 属性值不是数值类型时；</p></div><hr><div><div class="post-metas mb-3"><div class="post-meta"><i class="iconfont icon-tags"></i> <a class="hover-with-bg" href="/blog/tags/mapboxgl/">mapboxgl</a></div></div><p class="note note-warning">本博客所有文章除特别声明外，均采用 <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" rel="nofollow noopener noopener">CC BY-SA 4.0 协议</a> ，转载请注明出处！</p><div class="post-prevnext"><article class="post-prev col-6"><a href="/blog/posts/e6c6b2b1.html"><i class="iconfont icon-arrowleft"></i> <span class="hidden-mobile">WebGL编程指南学习笔记</span> <span class="visible-mobile">上一篇</span></a></article><article class="post-next col-6"><a href="/blog/posts/e1a3a842.html"><span class="hidden-mobile">Mapbox加载空白地图</span> <span class="visible-mobile">下一篇</span> <i class="iconfont icon-arrowright"></i></a></article></div></div></article></div></div></div><div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn"><div id="toc"><p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p><div class="toc-body" id="toc-body"></div></div></div></div></div><a id="scroll-top-button" href="#" role="button"><i class="iconfont icon-arrowup" aria-hidden="true"></i></a><div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable modal-lg" role="document"><div class="modal-content"><div class="modal-header text-center"><h4 class="modal-title w-100 font-weight-bold">搜索</h4><button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button></div><div class="modal-body mx-3"><div class="md-form mb-5"><input type="text" id="local-search-input" class="form-control validate"> <label data-error="x" data-success="v" for="local-search-input">关键词</label></div><div class="list-group" id="local-search-result"></div></div></div></div></div></main><footer class="text-center mt-5 py-3"><div class="footer-content"><a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a></div><div class="statistics"><span id="leancloud-site-pv-container" style="display:none">总访问量 <span id="leancloud-site-pv"></span> 次 </span><span id="leancloud-site-uv-container" style="display:none">总访客数 <span id="leancloud-site-uv"></span> 人</span></div><div class="beian"><span><a href="http://beian.miit.gov.cn/" target="_blank" rel="nofollow noopener">赣ICP备18013338-1号</a></span></div></footer><script src="https://cdn.staticfile.org/nprogress/0.2.0/nprogress.min.js"></script><link rel="stylesheet" href="https://cdn.staticfile.org/nprogress/0.2.0/nprogress.min.css"><script>NProgress.configure({showSpinner:!1,trickleSpeed:200}),NProgress.start(),window.addEventListener("load",(function(){NProgress.done()}))</script><script src="https://cdn.staticfile.org/jquery/3.5.1/jquery.min.js"></script><script src="https://cdn.staticfile.org/twitter-bootstrap/4.5.3/js/bootstrap.min.js"></script><script src="/blog/js/debouncer.js"></script><script src="/blog/js/events.js"></script><script src="/blog/js/plugins.js"></script><script src="/blog/js/lazyload.js"></script><script src="https://cdn.staticfile.org/tocbot/4.12.0/tocbot.min.js"></script><script src="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.js"></script><script src="https://cdn.staticfile.org/anchor-js/4.3.0/anchor.min.js"></script><script defer src="https://cdn.staticfile.org/clipboard.js/2.0.6/clipboard.min.js"></script><script defer src="/blog/js/leancloud.js"></script><script src="https://cdn.staticfile.org/typed.js/2.0.11/typed.min.js"></script><script>!function(t,i){(0,Fluid.plugins.typing)(i.getElementById("subtitle").title)}(window,document)</script><script src="/blog/js/local-search.js"></script><script>document.querySelector("#local-search-input").onclick=function(){searchFunc("/blog/local-search.xml","local-search-input","local-search-result"),this.onclick=null}</script><script defer>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?e57601b965796b6bd88329a0ca1e8b5e";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><script defer>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","147234769","auto"),ga("send","pageview")</script><script async src="https://www.google-analytics.com/analytics.js"></script><script src="/blog/js/custom.js"></script><script src="/blog/js/test.js"></script><script src="/blog/js/boot.js"></script><script src="//cdn.jsdelivr.net/npm/@waline/client/dist/Waline.min.js"></script><script src="/blog/js/comment.js"></script><script defer src="/blog/js/comment2.js"></script><script src="/blog/js/clicklove.js"></script></body></html>