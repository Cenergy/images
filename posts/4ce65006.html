<!DOCTYPE html><html lang="zh-CN" data-default-color-scheme="&#34;auto&#34;"><head><meta charset="UTF-8"><link rel="apple-touch-icon" sizes="76x76" href="/blog/img/favicon.png"><link rel="icon" type="image/png" href="/blog/img/favicon.png"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,shrink-to-fit=no"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="theme-color" content="#2f4154"><meta name="description" content="真正的伟大,即在于以脆弱的凡人之躯而具有神性的不可战胜。"><meta name="author" content="Hai"><meta name="keywords" content="爱即是诗,blog"><title>着色器之书09 - AIGISSS</title><link rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/4.5.3/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.staticfile.org/github-markdown-css/4.0.0/github-markdown.min.css"><link rel="stylesheet" href="/blog/lib/hint/hint.min.css"><link rel="stylesheet" href="https://cdn.staticfile.org/highlight.js/10.1.2/styles/tomorrow-night.min.css"><link rel="stylesheet" href="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css"><link rel="stylesheet" href="/blog/css/main.css"><link rel="stylesheet" href="/blog/styles/style.css"><script id="fluid-configs">var Fluid=window.Fluid||{},CONFIG={hostname:"www.aigisss.com",root:"/blog/",version:"1.8.7",typing:{enable:!0,typeSpeed:70,cursorChar:"✦",loop:!1},anchorjs:{enable:!0,element:"h1,h2,h3,h4,h5,h6",placement:"right",visible:"hover",icon:""},progressbar:{enable:!0,height_px:3,color:"#29d",options:{showSpinner:!1,trickleSpeed:200}},copy_btn:!0,image_zoom:{enable:!0},toc:{enable:!0,headingSelector:"h1,h2,h3,h4,h5,h6",collapseDepth:0},lazyload:{enable:!0,onlypost:!1},web_analytics:{enable:!0,baidu:"e57601b965796b6bd88329a0ca1e8b5e",google:147234769,gtag:null,tencent:{sid:null,cid:null},woyaola:null,cnzz:null,leancloud:{app_id:"diTi74ah5rpPDNa6bjS0VjqN-gzGzoHsz",app_key:"nHbjOKICQKYQtsVVJjeHYl0O",server_url:"https://diti74ah.lc-cn-n1-shared.com"},tajs:null}}</script><script src="/blog/js/utils.js"></script><script src="/blog/js/color-schema.js"></script><meta name="generator" content="Hexo 5.3.0"></head><body><header style="height:70vh"><nav id="navbar" class="navbar fixed-top navbar-expand-lg navbar-dark scrolling-navbar"><div class="container"><a class="navbar-brand" href="/blog/">&nbsp;<strong>AIGISSS</strong>&nbsp;</a> <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><div class="animated-icon"><span></span><span></span><span></span></div></button><div class="collapse navbar-collapse" id="navbarSupportedContent"><ul class="navbar-nav ml-auto text-center"><li class="nav-item"><a class="nav-link" href="http://www.aigisss.com"><i class="iconfont icon-google-fill"></i> 首页</a></li><li class="nav-item"><a class="nav-link" href="/blog/"><i class="iconfont icon-home-fill"></i> 博客</a></li><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" href="#" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><i class="iconfont icon-books"></i> 文章</a><div class="dropdown-menu" aria-labelledby="navbarDropdown"><a class="dropdown-item" href="/blog/archives/"><i class="iconfont icon-archive-fill"></i> 归档 </a><a class="dropdown-item" href="/blog/categories/"><i class="iconfont icon-category-fill"></i> 分类 </a><a class="dropdown-item" href="/blog/tags/"><i class="iconfont icon-tags-fill"></i> 标签</a></div></li><li class="nav-item"><a class="nav-link" href="/blog/photos/"><i class="iconfont icon-image"></i> 相册</a></li><li class="nav-item"><a class="nav-link" href="/blog/talks/"><i class="iconfont icon-kakao-talk-fill"></i> 说说</a></li><li class="nav-item"><a class="nav-link" href="/blog/about/"><i class="iconfont icon-user-fill"></i> 关于</a></li><li class="nav-item"><a class="nav-link" href="/blog/links/"><i class="iconfont icon-link-fill"></i> 友链</a></li><li class="nav-item" id="search-btn"><a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;<i class="iconfont icon-search"></i>&nbsp;</a></li><li class="nav-item" id="color-toggle-btn"><a class="nav-link" href="javascript:" rel="external nofollow noreferrer">&nbsp;<i class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a></li></ul></div></div></nav><div class="banner" id="banner" parallax="true" style="background:url(https://rmt.dogedoge.com/fetch/fluid/storage/bg/dojm2h.png?w=1920&q=100&fmt=webp) no-repeat center center;background-size:cover"><div class="full-bg-img"><div class="mask flex-center" style="background-color:rgba(0,0,0,.3)"><div class="page-header text-center fade-in-up"><span class="h2" id="subtitle" title="着色器之书09"></span><div class="mt-3"><span class="post-meta"><i class="iconfont icon-date-fill" aria-hidden="true"></i> <time datetime="2020-09-02 13:14" pubdate>2020年9月2日 下午</time></span></div><div class="mt-1"><span class="post-meta mr-2"><i class="iconfont icon-chart"></i> 1.8k 字 </span><span class="post-meta mr-2"><i class="iconfont icon-clock-fill"></i> 18 分钟 </span><span id="leancloud-page-views-container" class="post-meta" style="display:none"><i class="iconfont icon-eye" aria-hidden="true"></i> <span id="leancloud-page-views"></span> 次</span></div></div></div></div></div></header><main><div class="container-fluid nopadding-x"><div class="row nomargin-x"><div class="d-none d-lg-block col-lg-2"></div><div class="col-lg-8 nopadding-x-md"><div class="container nopadding-x-md" id="board-ctn"><div class="py-5" id="board"><article class="post-content mx-auto"><h1 style="display:none">着色器之书09</h1><p class="note note-info">本文最后更新于：14 天前</p><div class="markdown-body"><h2 id="Patterns-图案"><a href="#Patterns-图案" class="headerlink" title="Patterns 图案"></a>Patterns 图案</h2><p>因为着色器按一个个像素执行，那么无论你重复一个图形多少次，计算的数量仍然是个常数。</p><p><a href="../edit.php#09/dots5.frag"><img src="/blog/posts/4ce65006/warmerdam.jpg" srcset="/blog/img/loading.gif" title="Nina Warmerdam"></a></p><p>本章中我们将综合我们目前所学的并应用在画布上。和前几章一样，我们的策略依然基于乘以空间坐标（0到1之间），这样我们的画的在0到1之间的图形就会重复地形成网格。</p><p><em>“网格提供一种基于人的直觉发明事物的框架，并且可以颠覆。自然的混沌肌理提供一种对比和秩序的迹象。从早期罗马浴场里的陶瓷图案到几何镶嵌，人们那时候就习惯用网格来点缀他们的生活。”</em><a target="_blank" rel="noopener external nofollow noreferrer" href="http://10print.org/"><em>10 PRINT</em>, Mit Press, (2013)</a></p><p>首先让我们记住 <a href="../glossary/?search=fract"><code>fract()</code></a> 函数。它返回一个数的分数部分，本质上是除1的余数（<a href="../glossary/?search=mod"><code>mod(x,1.0)</code></a>）。换句话说， <a href="../glossary/?search=fract"><code>fract()</code></a> 返回小数点后的数。 我们单位化的坐标系变量 (<code>st</code>) 已经是 0.0 到 1.0 之间的了。所以像下面这么做并没有必要：</p><figure class="highlight glsl"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs glsl"><span class="hljs-type">void</span> main()&#123;<br>	<span class="hljs-type">vec2</span> st = <span class="hljs-built_in">gl_FragCoord</span>.xy/u_resolution;<br>	<span class="hljs-type">vec3</span> color = <span class="hljs-type">vec3</span>(<span class="hljs-number">0.0</span>);<br>    st = <span class="hljs-built_in">fract</span>(st);<br>	color = <span class="hljs-type">vec3</span>(st,<span class="hljs-number">0.0</span>);<br>	<span class="hljs-built_in">gl_FragColor</span> = <span class="hljs-type">vec4</span>(color,<span class="hljs-number">1.0</span>);<br>&#125;<br></code></pre></div></td></tr></table></figure><p>但如果我们放大单位化坐标系 — 比如说3倍 — 我们会得到三组 0 到 1 的线性插值的数列：第一组在 0-1 之间，第二组浮点数在 1-2 之间以及第三组在 2-3 之间的浮点数。</p><div class="container" style="margin:0;padding:0"><div class="codeAndCanvas" data="/blog/glsl/grid-making.frag" style="width:100%;height:auto;margin-bottom:10px"></div></div><p>现在是时候在子空间（网格单元的空间）里画点什么了。取消27行的注释。（因为我们等比例放大了x和y坐标，所以不会改变坐标的比例，图形会和预期的一样。）</p><p>试试下面的练习来深入理解：</p><ul><li><p>把空间乘以不同的数。试试用浮点数，还有分别给x和y不同的系数。</p></li><li><p>把这个平铺技巧做成一个可以反复使用的函数。</p></li><li><p>把画布分成 3 行 3 列。 指出如何定义行和列的线程的，并用这种方式改变显示着的图形。试着做一个井字棋。</p></li></ul><h3 id="在图案内部应用矩阵"><a href="#在图案内部应用矩阵" class="headerlink" title="在图案内部应用矩阵"></a>在图案内部应用矩阵</h3><p>鉴于每个细分或者说单元都是我们正在使用的单位化坐标系的小单元，我们可以对每个内部空间施以矩阵变换来平移，旋转和缩放。</p><div class="container" style="margin:0;padding:0"><div class="codeAndCanvas" data="/blog/glsl/checks.frag" style="width:100%;height:auto;margin-bottom:10px"></div></div><ul><li><p>想想怎么让这些图案有趣的动起来。考虑颜色，形状，运动的变换。做三种动画。</p></li><li><p>通过组合不同的形状重新创造更复杂的图案。</p></li></ul><div class="container" style="margin:0;padding:0"><a href="https://www.aigisss.com/glsl/#/diamondtiles"><canvas id="custom" class="canvas" data-fragment-url="/blog/glsl/diamondtiles.frag" style="width:100%;object-fit:contain;min-height:100px"></canvas></a></div><ul><li>结合多层图案来制作你自己的 <a target="_blank" rel="noopener external nofollow noreferrer" href="https://www.google.com/search?q=scottish+patterns+fabric&amp;tbm=isch&amp;tbo=u&amp;source=univ&amp;sa=X&amp;ei=Y1aFVfmfD9P-yQTLuYCIDA&amp;ved=0CB4QsAQ&amp;biw=1399&amp;bih=799#tbm=isch&amp;q=Scottish+Tartans+Patterns">Scottish Tartan Patterns</a>.</li></ul><p><a target="_blank" rel="noopener external nofollow noreferrer" href="http://graphicriver.net/item/vector-pattern-scottish-tartan/6590076"><img src="/blog/posts/4ce65006/tartan-1599051168043.jpg" srcset="/blog/img/loading.gif" title="Vector Pattern Scottish Tartan By Kavalenkava"></a></p><h3 id="偏移图案"><a href="#偏移图案" class="headerlink" title="偏移图案"></a>偏移图案</h3><p>So let’s say we want to imitate a brick wall. Looking at the wall, you can see a half brick offset on x in every other row. How we can do that?</p><p>假如我们想要模仿砖墙。看，下面的墙，你是不是看到一半的砖在x方向上偏移了一半砖的长度，没隔一行偏移一次。我们如何实现？</p><img src="/blog/posts/4ce65006/brick-1599051171980.jpg" srcset="/blog/img/loading.gif"><p>第一步我们需要知道某行的线程是奇数还是偶数，以为我们可以通过奇偶来决定是否要在x方向上偏移那一行。</p><p><strong><strong>我们需要两段来解决这个问题</strong></strong></p><p>要判断我们的线程是一个奇数行或者偶数行，我们要用 <code>2.0</code> 的 <a href="../glossary/?search=mod"><code>mod()</code></a> 。 然后根据结果是否大于 <code>1.0</code> 来判断。看一下下面的函数，取消最后两行的注释。</p><div class="simpleFunction" data="y = mod(x,2.0);
// y = mod(x,2.0) < 1.0 ? 0. : 1. ;
// y = step(1.0,mod(x,2.0));"></div><p>正如你所见，我们可以用一个 <a target="_blank" rel="noopener external nofollow noreferrer" href="https://en.wikipedia.org/wiki/%3F:">三元算符号</a> （第二行）来检查 <code>2.0</code> 的<a href="../glossary/?search=mod"><code>mod()</code></a>（余数）小于 <code>1.0</code> 或者类似地，我们用 <a href="../glossary/?search=step"><code>step()</code></a> 函数做相同的操作，但（其实）更快。为什么呢？ 因为虽然要知道每个显卡如何优化和编译代码并不容易，但是可以安全地假设内置函数总比非内置的函数快。任何时候你都以调用内置函数，干嘛不用呢！</p><p>现在我们有这些找出奇数的方程，这样我们就可以给奇数行一个偏移量，然后就可以把 <em>砖块</em> 做出拼砖的效果。下面代码的第14行便是我们用来“侦测”奇数行，并予之半个单位在x上的偏移的。注意到对偶数行，函数的返回值是 <code>0.0</code>， <code>0.0</code> 乘以 <code>0.5</code> 得到一个 <code>0.0</code> 的偏移。 但是奇数行我们用函数的返回值， <code>1.0</code>， 乘以偏移量 <code>0.5</code>，这样便向坐标系的 <code>x</code> 轴偏移了 <code>0.5</code>。</p><p>现在试着取消32行的注释 — 拉伸长宽比来模仿“现代砖块”的长宽比。通过取消第40行的的代码，你可以注意到坐标系统是如何看起来映射到红绿色的。</p><div class="container" style="margin:0;padding:0"><div class="codeAndCanvas" data="/blog/glsl/bricks.frag" style="width:100%;height:auto;margin-bottom:10px"></div></div><ul><li><p>试着根据时间变化对偏移量做动画。</p></li><li><p>另做一个动画，让偶数行向左移，奇数行向右移动。</p></li><li><p>能不能根据列重复这样的效果？</p></li><li><p>试着结合 <code>x</code> 和 <code>y</code> 轴的偏移来得到下面这样的效果：</p></li></ul><div class="container" style="margin:0;padding:0"><a href="https://www.aigisss.com/glsl/#/marching_dots"><canvas id="custom" class="canvas" data-fragment-url="/blog/glsl/marching_dots.frag" style="width:100%;object-fit:contain;min-height:100px"></canvas></a></div><h2 id="Truchet-瓷砖"><a href="#Truchet-瓷砖" class="headerlink" title="Truchet 瓷砖"></a>Truchet 瓷砖</h2><p>目前我们学了如何区分奇数行/列或偶数行/列，（类似的），（我们也）可能再用（这个技巧）根据位置来设计元素。 考虑到 <a target="_blank" rel="noopener external nofollow noreferrer" href="http://en.wikipedia.org/wiki/Truchet_tiles">Truchet Tiles</a> 的例子，即一个单一设计元素可以以四种不同的方式呈现：</p><img src="/blog/posts/4ce65006/truchet-00-1599051176947.png" srcset="/blog/img/loading.gif"><p>通过改变对角瓷砖的图案，便可能组成无限种复杂设计的可能。</p><img src="/blog/posts/4ce65006/truchet-01-1599051178978.png" srcset="/blog/img/loading.gif"><p>仔细观察 <code>rotateTilePattern()</code> 函数, 它把坐标空间细分成四个单元并赋予每一个旋转值。</p><div class="container" style="margin:0;padding:0"><div class="codeAndCanvas" data="/blog/glsl/truchet.frag" style="width:100%;height:auto;margin-bottom:10px"></div></div><ul><li><p>注释，取消注释，以及复制第69到72行来创作新的设计。</p></li><li><p>把黑白三角变成其他元素，例如：半圆，旋转的方形或直线。</p></li><li><p>编写根据元素自身位置旋转的图形代码。</p></li><li><p>创作一个根据其位置改变其他属性的图案。</p></li><li><p>想想其他能用这章原理的案例，不一定是图案. (例: 易经卦)</p></li></ul><div class="container" style="margin:0;padding:0"><a href="https://www.aigisss.com/glsl/#/iching"><canvas id="custom" class="canvas" data-fragment-url="/blog/glsl/iching-01.frag" style="width:100%;object-fit:contain;min-height:100px"></canvas></a></div><h2 id="制定自己的规则"><a href="#制定自己的规则" class="headerlink" title="制定自己的规则"></a>制定自己的规则</h2><p>制作程序图案是种寻找最小可重复元素的古老练习（灵修）。我们作为长时间使用网格和图案来装饰织物、地面和物品的镶边物种：从古希腊的弯曲图案，到中国的窗栅设计，重复和变化的愉悦吸引我们的想象。花些时间浏览 <a target="_blank" rel="noopener external nofollow noreferrer" href="https://archive.org/stream/traditionalmetho00chririch#page/130/mode/2up">decorative</a> <a target="_blank" rel="noopener external nofollow noreferrer" href="https://www.pinterest.com/patriciogonzv/paterns/">patterns</a> 并看看在漫长的历史里，艺术家和设计师是如何寻找在秩序的预测性和（由）混沌和衍变（产生）的惊奇之间的边界的。从阿拉伯几何图案，到斑斓的非洲编制艺术，这里有一整个图案的宇宙要学习。</p><img src="/blog/posts/4ce65006/geometricpatters.png" srcset="/blog/img/loading.gif" title="Franz Sales Meyer"><p>这章我们就结束算法绘图部分了。在接下来的章节，我们会学习如何把熵（其实就是混乱和随机的意思）加入到我们的着色器中来产生生成设计。</p></div><hr><div><div class="post-metas mb-3"><div class="post-meta mr-3"><i class="iconfont icon-category"></i> <a class="hover-with-bg" href="/blog/categories/%E6%9C%AA%E5%88%86%E7%B1%BB/">未分类</a></div></div><p class="note note-warning">本博客所有文章除特别声明外，均采用 <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" rel="nofollow noopener noopener">CC BY-SA 4.0 协议</a> ，转载请注明出处！</p><div class="post-prevnext"><article class="post-prev col-6"><a href="/blog/posts/2c21d9e3.html"><i class="iconfont icon-arrowleft"></i> <span class="hidden-mobile">着色器之书10</span> <span class="visible-mobile">上一篇</span></a></article><article class="post-next col-6"><a href="/blog/posts/3be16090.html"><span class="hidden-mobile">着色器之书08</span> <span class="visible-mobile">下一篇</span> <i class="iconfont icon-arrowright"></i></a></article></div></div></article></div></div></div><div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn"><div id="toc"><p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p><div class="toc-body" id="toc-body"></div></div></div></div></div><a id="scroll-top-button" href="#" role="button"><i class="iconfont icon-arrowup" aria-hidden="true"></i></a><div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable modal-lg" role="document"><div class="modal-content"><div class="modal-header text-center"><h4 class="modal-title w-100 font-weight-bold">搜索</h4><button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button></div><div class="modal-body mx-3"><div class="md-form mb-5"><input type="text" id="local-search-input" class="form-control validate"> <label data-error="x" data-success="v" for="local-search-input">关键词</label></div><div class="list-group" id="local-search-result"></div></div></div></div></div></main><footer class="text-center mt-5 py-3"><div class="footer-content"><a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a></div><div class="statistics"><span id="leancloud-site-pv-container" style="display:none">总访问量 <span id="leancloud-site-pv"></span> 次 </span><span id="leancloud-site-uv-container" style="display:none">总访客数 <span id="leancloud-site-uv"></span> 人</span></div><div class="beian"><span><a href="http://beian.miit.gov.cn/" target="_blank" rel="nofollow noopener">赣ICP备18013338-1号</a></span></div></footer><script src="https://cdn.staticfile.org/nprogress/0.2.0/nprogress.min.js"></script><link rel="stylesheet" href="https://cdn.staticfile.org/nprogress/0.2.0/nprogress.min.css"><script>NProgress.configure({showSpinner:!1,trickleSpeed:200}),NProgress.start(),window.addEventListener("load",(function(){NProgress.done()}))</script><script src="https://cdn.staticfile.org/jquery/3.5.1/jquery.min.js"></script><script src="https://cdn.staticfile.org/twitter-bootstrap/4.5.3/js/bootstrap.min.js"></script><script src="/blog/js/debouncer.js"></script><script src="/blog/js/events.js"></script><script src="/blog/js/plugins.js"></script><script src="/blog/js/lazyload.js"></script><script src="https://cdn.staticfile.org/tocbot/4.12.0/tocbot.min.js"></script><script src="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.js"></script><script src="https://cdn.staticfile.org/anchor-js/4.3.0/anchor.min.js"></script><script defer src="https://cdn.staticfile.org/clipboard.js/2.0.6/clipboard.min.js"></script><script defer src="/blog/js/leancloud.js"></script><script src="https://cdn.staticfile.org/typed.js/2.0.11/typed.min.js"></script><script>!function(t,i){(0,Fluid.plugins.typing)(i.getElementById("subtitle").title)}(window,document)</script><script src="/blog/js/local-search.js"></script><script>document.querySelector("#local-search-input").onclick=function(){searchFunc("/blog/local-search.xml","local-search-input","local-search-result"),this.onclick=null}</script><script defer>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?e57601b965796b6bd88329a0ca1e8b5e";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><script defer>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","147234769","auto"),ga("send","pageview")</script><script async src="https://www.google-analytics.com/analytics.js"></script><script src="/blog/js/custom.js"></script><script src="/blog/js/test.js"></script><script src="/blog/js/boot.js"></script><link defer rel="stylesheet" href="/blog/styles/glslEditor.css"><script defer src="/blog/js/glslCanvas.js"></script><script defer src="/blog/js/glslEditor.js"></script><script defer src="/blog/js/glslPost.js"></script><script src="//cdn.jsdelivr.net/npm/@waline/client/dist/Waline.min.js"></script><script src="/blog/js/comment.js"></script><script defer src="/blog/js/comment2.js"></script><script src="/blog/js/clicklove.js"></script></body></html>