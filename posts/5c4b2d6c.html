<!DOCTYPE html><html lang="zh-CN" data-default-color-scheme="&#34;auto&#34;"><head><meta charset="UTF-8"><link rel="apple-touch-icon" sizes="76x76" href="/blog/img/favicon.png"><link rel="icon" type="image/png" href="/blog/img/favicon.png"><meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no,shrink-to-fit=no"><meta http-equiv="x-ua-compatible" content="ie=edge"><meta name="theme-color" content="#2f4154"><meta name="description" content="真正的伟大,即在于以脆弱的凡人之躯而具有神性的不可战胜。"><meta name="author" content="Hai"><meta name="keywords" content="爱即是诗,blog"><title>着色器之书15 - AIGISSS</title><link rel="stylesheet" href="https://cdn.staticfile.org/twitter-bootstrap/4.5.3/css/bootstrap.min.css"><link rel="stylesheet" href="https://cdn.staticfile.org/github-markdown-css/4.0.0/github-markdown.min.css"><link rel="stylesheet" href="/blog/lib/hint/hint.min.css"><link rel="stylesheet" href="https://cdn.staticfile.org/highlight.js/10.1.2/styles/tomorrow-night.min.css"><link rel="stylesheet" href="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_ba1fz6golrf.css"><link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_kmeydafke9r.css"><link rel="stylesheet" href="/blog/css/main.css"><link rel="stylesheet" href="/blog/styles/style.css"><script id="fluid-configs">var Fluid=window.Fluid||{},CONFIG={hostname:"www.aigisss.com",root:"/blog/",version:"1.8.7",typing:{enable:!0,typeSpeed:70,cursorChar:"✦",loop:!1},anchorjs:{enable:!0,element:"h1,h2,h3,h4,h5,h6",placement:"right",visible:"hover",icon:""},progressbar:{enable:!0,height_px:3,color:"#29d",options:{showSpinner:!1,trickleSpeed:200}},copy_btn:!0,image_zoom:{enable:!0},toc:{enable:!0,headingSelector:"h1,h2,h3,h4,h5,h6",collapseDepth:0},lazyload:{enable:!0,onlypost:!1},web_analytics:{enable:!0,baidu:"e57601b965796b6bd88329a0ca1e8b5e",google:147234769,gtag:null,tencent:{sid:null,cid:null},woyaola:null,cnzz:null,leancloud:{app_id:"diTi74ah5rpPDNa6bjS0VjqN-gzGzoHsz",app_key:"nHbjOKICQKYQtsVVJjeHYl0O",server_url:"https://diti74ah.lc-cn-n1-shared.com"},tajs:null}}</script><script src="/blog/js/utils.js"></script><script src="/blog/js/color-schema.js"></script><meta name="generator" content="Hexo 5.3.0"></head><body><header style="height:70vh"><nav id="navbar" class="navbar fixed-top navbar-expand-lg navbar-dark scrolling-navbar"><div class="container"><a class="navbar-brand" href="/blog/">&nbsp;<strong>AIGISSS</strong>&nbsp;</a> <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation"><div class="animated-icon"><span></span><span></span><span></span></div></button><div class="collapse navbar-collapse" id="navbarSupportedContent"><ul class="navbar-nav ml-auto text-center"><li class="nav-item"><a class="nav-link" href="http://www.aigisss.com"><i class="iconfont icon-google-fill"></i> 首页</a></li><li class="nav-item"><a class="nav-link" href="/blog/"><i class="iconfont icon-home-fill"></i> 博客</a></li><li class="nav-item dropdown"><a class="nav-link dropdown-toggle" href="#" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><i class="iconfont icon-books"></i> 文章</a><div class="dropdown-menu" aria-labelledby="navbarDropdown"><a class="dropdown-item" href="/blog/archives/"><i class="iconfont icon-archive-fill"></i> 归档 </a><a class="dropdown-item" href="/blog/categories/"><i class="iconfont icon-category-fill"></i> 分类 </a><a class="dropdown-item" href="/blog/tags/"><i class="iconfont icon-tags-fill"></i> 标签</a></div></li><li class="nav-item"><a class="nav-link" href="/blog/photos/"><i class="iconfont icon-image"></i> 相册</a></li><li class="nav-item"><a class="nav-link" href="/blog/talks/"><i class="iconfont icon-kakao-talk-fill"></i> 说说</a></li><li class="nav-item"><a class="nav-link" href="/blog/about/"><i class="iconfont icon-user-fill"></i> 关于</a></li><li class="nav-item"><a class="nav-link" href="/blog/links/"><i class="iconfont icon-link-fill"></i> 友链</a></li><li class="nav-item" id="search-btn"><a class="nav-link" data-toggle="modal" data-target="#modalSearch">&nbsp;<i class="iconfont icon-search"></i>&nbsp;</a></li><li class="nav-item" id="color-toggle-btn"><a class="nav-link" href="javascript:" rel="external nofollow noreferrer">&nbsp;<i class="iconfont icon-dark" id="color-toggle-icon"></i>&nbsp;</a></li></ul></div></div></nav><div class="banner" id="banner" parallax="true" style="background:url(https://rmt.dogedoge.com/fetch/fluid/storage/bg/dojm2h.png?w=1920&q=100&fmt=webp) no-repeat center center;background-size:cover"><div class="full-bg-img"><div class="mask flex-center" style="background-color:rgba(0,0,0,.3)"><div class="page-header text-center fade-in-up"><span class="h2" id="subtitle" title="着色器之书15"></span><div class="mt-3"><span class="post-meta"><i class="iconfont icon-date-fill" aria-hidden="true"></i> <time datetime="2020-09-16 20:04" pubdate>2020年9月16日 晚上</time></span></div><div class="mt-1"><span class="post-meta mr-2"><i class="iconfont icon-chart"></i> 879 字 </span><span class="post-meta mr-2"><i class="iconfont icon-clock-fill"></i> 17 分钟 </span><span id="leancloud-page-views-container" class="post-meta" style="display:none"><i class="iconfont icon-eye" aria-hidden="true"></i> <span id="leancloud-page-views"></span> 次</span></div></div></div></div></div></header><main><div class="container-fluid nopadding-x"><div class="row nomargin-x"><div class="d-none d-lg-block col-lg-2"></div><div class="col-lg-8 nopadding-x-md"><div class="container nopadding-x-md" id="board-ctn"><div class="py-5" id="board"><article class="post-content mx-auto"><h1 style="display:none">着色器之书15</h1><p class="note note-info">本文最后更新于：14 天前</p><div class="markdown-body"><h1 id="图像处理"><a href="#图像处理" class="headerlink" title="图像处理"></a>图像处理</h1><h2 id="贴图"><a href="#贴图" class="headerlink" title="贴图"></a>贴图</h2><img src="/blog/posts/5c4b2d6c/01.jpg" srcset="/blog/img/loading.gif"><p>Graphic cards (GPUs) have special memory types for images. Usually on CPUs images are stored as arrays of bytes but GPUs store images as <code>sampler2D</code> which is more like a table (or matrix) of floating point vectors. More interestingly, the values of this <em>table</em> of vectors are continuous. That means that values between pixels are interpolated in a low level.</p><p>In order to use this feature we first need to <em>upload</em> the image from the CPU to the GPU, to then pass the <code>id</code> of the texture to the right <a href="../05"><code>uniform</code></a>. All that happens outside the shader.</p><p>Once the texture is loaded and linked to a valid <code>uniform sampler2D</code> you can ask for specific color value at specific coordinates (formated on a <a href="index.html#vec2.md"><code>vec2</code></a> variable) using the <a href="index.html#texture2D.md"><code>texture2D()</code></a> function which will return a color formatted on a <a href="index.html#vec4.md"><code>vec4</code></a> variable.</p><figure class="highlight glsl"><table><tr><td class="gutter hljs"><div class="hljs code-wrapper"><pre><span class="line">1</span><br></pre></div></td><td class="code"><div class="hljs code-wrapper"><pre><code class="hljs glsl"><span class="hljs-type">vec4</span> <span class="hljs-built_in">texture2D</span>(<span class="hljs-type">sampler2D</span> <span class="hljs-built_in">texture</span>, <span class="hljs-type">vec2</span> coordinates)  <br></code></pre></div></td></tr></table></figure><p>Check the following code where we load Hokusai’s Wave (1830) as <code>uniform sampler2D u_tex0</code> and we call every pixel of it inside the billboard:</p><div class="container" style="margin:0;padding:0"><div class="codeAndCanvas" data="/blog/glsl/15/texture.frag" style="width:100%;height:auto;margin-bottom:10px"></div></div><p>If you pay attention you will note that the coordinates for the texture are normalized! What a surprise right? Textures coordinates are consistent with the rest of the things we had seen and their coordinates are between 0.0 and 1.0 which match perfectly with the normalized space coordinates we have been using.</p><p>Now that you have seen how we correctly load a texture, it is time to experiment to discover what we can do with it, by trying:</p><ul><li>Scaling the previous texture by half.</li><li>Rotating the previous texture 90 degrees.</li><li>Hooking the mouse position to the coordinates to move it.</li></ul><p>Why you should be excited about textures? Well first of all forget about the sad 255 values for channel; once your image is transformed into a <code>uniform sampler2D</code> you have all the values between 0.0 and 1.0 (depending on what you set the <code>precision</code> to ). That’s why shaders can make really beautiful post-processing effects.</p><p>Second, the <a href="index.html#vec2.md"><code>vec2()</code></a> means you can get values even between pixels. As we said before the textures are a continuum. This means that if you set up your texture correctly you can ask for values all around the surface of your image and the values will smoothly vary from pixel to pixel with no jumps!</p><p>Finally, you can set up your image to repeat in the edges, so if you give values over or lower of the normalized 0.0 and 1.0, the values will wrap around starting over.</p><p>All these features make your images more like an infinite spandex fabric. You can stretch and shrink your texture without noticing the grid of bytes they are originally composed of or the ends of it. To experience this take a look at the following code where we distort a texture using <a href="../11/">the noise function we already made</a>.</p><div class="container" style="margin:0;padding:0"><div class="codeAndCanvas" data="/blog/glsl/15/texture-noise.frag" data-textures="/blog/images/hokusai.jpg" style="width:100%;height:auto;margin-bottom:10px"></div></div><h2 id="纹理分辨率"><a href="#纹理分辨率" class="headerlink" title="纹理分辨率"></a>纹理分辨率</h2><p>Above examples play well with squared images, where both sides are equal and match our squared billboard. But for non-squared images things can be a little more tricky, and unfortunately centuries of pictorial art and photography found more pleasant to the eye non-squared proportions for images.</p><img src="/blog/posts/5c4b2d6c/nicephore.jpg" srcset="/blog/img/loading.gif" title="Joseph Nicéphore Niépce (..&#x2F;..&#x2F;..&#x2F;..&#x2F;Github&#x2F;thebookofshaders&#x2F;15&#x2F;nicephore.jpg)"><p>How we can solve this problem? Well we need to know the original proportions of the image to know how to stretch the texture correctly in order to have the original <a target="_blank" rel="noopener external nofollow noreferrer" href="http://en.wikipedia.org/wiki/Aspect_ratio"><em>aspect ratio</em></a>. For that the texture width and height are passed to the shader as an <code>uniform</code>, which in our example framework are passed as an <code>uniform vec2</code> with the same name of the texture followed with proposition <code>Resolution</code>. Once we have this information on the shader we can get the aspect ratio by dividing the <code>width</code> for the <code>height</code> of the texture resolution. Finally by multiplying this ratio to the coordinates on <code>y</code> we will shrink this axis to match the original proportions.</p><p>Uncomment line 21 of the following code to see this in action.</p><div class="container" style="margin:0;padding:0"><div class="codeAndCanvas" data="/blog/glsl/15/texture-resolution.frag" data-textures="/blog/images/nicephore.jpg" style="width:100%;height:auto;margin-bottom:10px"></div></div><ul><li>What we need to do to center this image?</li></ul><h2 id="数码装饰"><a href="#数码装饰" class="headerlink" title="数码装饰"></a>数码装饰</h2><img src="/blog/posts/5c4b2d6c/03.jpg" srcset="/blog/img/loading.gif"><p>You may be thinking that this is unnecessarily complicated… and you are probably right. Also this way of working with images leaves enough room to different hacks and creative tricks. Try to imagine that you are an upholster and by stretching and folding a fabric over a structure you can create better and new patterns and techniques.</p><img src="/blog/posts/5c4b2d6c/muybridge.jpg" srcset="/blog/img/loading.gif" title="Eadweard" alt="s Muybridge study of motion"><p>This level of craftsmanship links back to some of the first optical experiments ever made. For example on games <em>sprite animations</em> are very common, and is inevitably to see on it reminiscence to phenakistoscope, zoetrope and praxinoscope.</p><p>This could seem simple but the possibilities of modifying textures coordinates are enormous. For example:</p><div class="container" style="margin:0;padding:0"><div class="codeAndCanvas" data="/blog/glsl/15/texture-sprite.frag" data-textures="/blog/images/muybridge.jpg" style="width:100%;height:auto;margin-bottom:10px"></div></div><p>Now is your turn:</p><ul><li><p>Can you make a kaleidoscope using what we have learned?</p></li><li><p>Way before Oculus or google cardboard, stereoscopic photography was a big thing. Could you code a simple shader to re-use these beautiful images?</p></li></ul><div class="container" style="margin:0;padding:0"><a href="../edit.php#10/ikeda-03.frag"><canvas id="custom" class="canvas" data-fragment-url="ikeda-03.frag" style="width:100%;height:auto;margin-bottom:10px"></canvas></a></div><ul><li>What other optical toys can you re-create using textures?</li></ul><p>In the next chapters we will learn how to do some image processing using shaders. You will note that finally the complexity of shader makes sense, because it was in a big sense designed to do this type of process. We will start doing some image operations!</p></div><hr><div><div class="post-metas mb-3"><div class="post-meta mr-3"><i class="iconfont icon-category"></i> <a class="hover-with-bg" href="/blog/categories/%E6%9C%AA%E5%88%86%E7%B1%BB/">未分类</a></div></div><p class="note note-warning">本博客所有文章除特别声明外，均采用 <a target="_blank" href="https://creativecommons.org/licenses/by-sa/4.0/deed.zh" rel="nofollow noopener noopener">CC BY-SA 4.0 协议</a> ，转载请注明出处！</p><div class="post-prevnext"><article class="post-prev col-6"><a href="/blog/posts/c5427cd6.html"><i class="iconfont icon-arrowleft"></i> <span class="hidden-mobile">着色器之书16</span> <span class="visible-mobile">上一篇</span></a></article><article class="post-next col-6"><a href="/blog/posts/2b4c1dfa.html"><span class="hidden-mobile">着色器之书14</span> <span class="visible-mobile">下一篇</span> <i class="iconfont icon-arrowright"></i></a></article></div></div></article></div></div></div><div class="d-none d-lg-block col-lg-2 toc-container" id="toc-ctn"><div id="toc"><p class="toc-header"><i class="iconfont icon-list"></i>&nbsp;目录</p><div class="toc-body" id="toc-body"></div></div></div></div></div><a id="scroll-top-button" href="#" role="button"><i class="iconfont icon-arrowup" aria-hidden="true"></i></a><div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel" aria-hidden="true"><div class="modal-dialog modal-dialog-scrollable modal-lg" role="document"><div class="modal-content"><div class="modal-header text-center"><h4 class="modal-title w-100 font-weight-bold">搜索</h4><button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button></div><div class="modal-body mx-3"><div class="md-form mb-5"><input type="text" id="local-search-input" class="form-control validate"> <label data-error="x" data-success="v" for="local-search-input">关键词</label></div><div class="list-group" id="local-search-result"></div></div></div></div></div></main><footer class="text-center mt-5 py-3"><div class="footer-content"><a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a></div><div class="statistics"><span id="leancloud-site-pv-container" style="display:none">总访问量 <span id="leancloud-site-pv"></span> 次 </span><span id="leancloud-site-uv-container" style="display:none">总访客数 <span id="leancloud-site-uv"></span> 人</span></div><div class="beian"><span><a href="http://beian.miit.gov.cn/" target="_blank" rel="nofollow noopener">赣ICP备18013338-1号</a></span></div></footer><script src="https://cdn.staticfile.org/nprogress/0.2.0/nprogress.min.js"></script><link rel="stylesheet" href="https://cdn.staticfile.org/nprogress/0.2.0/nprogress.min.css"><script>NProgress.configure({showSpinner:!1,trickleSpeed:200}),NProgress.start(),window.addEventListener("load",(function(){NProgress.done()}))</script><script src="https://cdn.staticfile.org/jquery/3.5.1/jquery.min.js"></script><script src="https://cdn.staticfile.org/twitter-bootstrap/4.5.3/js/bootstrap.min.js"></script><script src="/blog/js/debouncer.js"></script><script src="/blog/js/events.js"></script><script src="/blog/js/plugins.js"></script><script src="/blog/js/lazyload.js"></script><script src="https://cdn.staticfile.org/tocbot/4.12.0/tocbot.min.js"></script><script src="https://cdn.staticfile.org/fancybox/3.5.7/jquery.fancybox.min.js"></script><script src="https://cdn.staticfile.org/anchor-js/4.3.0/anchor.min.js"></script><script defer src="https://cdn.staticfile.org/clipboard.js/2.0.6/clipboard.min.js"></script><script defer src="/blog/js/leancloud.js"></script><script src="https://cdn.staticfile.org/typed.js/2.0.11/typed.min.js"></script><script>!function(t,i){(0,Fluid.plugins.typing)(i.getElementById("subtitle").title)}(window,document)</script><script src="/blog/js/local-search.js"></script><script>document.querySelector("#local-search-input").onclick=function(){searchFunc("/blog/local-search.xml","local-search-input","local-search-result"),this.onclick=null}</script><script defer>var _hmt=_hmt||[];!function(){var e=document.createElement("script");e.src="https://hm.baidu.com/hm.js?e57601b965796b6bd88329a0ca1e8b5e";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)}()</script><script defer>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","147234769","auto"),ga("send","pageview")</script><script async src="https://www.google-analytics.com/analytics.js"></script><script src="/blog/js/custom.js"></script><script src="/blog/js/test.js"></script><script src="/blog/js/boot.js"></script><link defer rel="stylesheet" href="/blog/styles/glslEditor.css"><script defer src="/blog/js/glslCanvas.js"></script><script defer src="/blog/js/glslEditor.js"></script><script defer src="/blog/js/glslPost.js"></script><script src="//cdn.jsdelivr.net/npm/@waline/client/dist/Waline.min.js"></script><script src="/blog/js/comment.js"></script><script defer src="/blog/js/comment2.js"></script><script src="/blog/js/clicklove.js"></script></body></html>